#!/bin/env bash

if [ "$1" != "--dev" ]; then
    return 0 || exit 0
fi
shift
echo -e "\033[35mYou are on development mode, I assume you know what you are doing.\033[0m"
read -n 1 -s -r -p "[ENTER:yes ANY:no] Proceed? " key ; [[ -z "$key" ]] || exit 0



# case $1 in
    
#     set-clone) #? Set a new Clone directory
#         newClone=$3
#         if [ -d "$newClone" ]; then
#             echo "Setting new clone directory!"
#             sed -i "/^CloneDir=/c\CloneDir=\"$newClone\"" "$HOME"/.config/hypr/scripts/globalcontrol.sh
#         else
#             echo "Directory [ $newClone] does not exist"
#             # ; read -t 3
#             # cd $HOME || exit
#             # newClone=$(fzf)
#             # sed -i "/^CloneDir=/c\CloneDir=\"$newClone\"" "$HOME"/.config/hypr/scripts/globalcontrol.sh
#             exit 0
#         fi
#         cd "$newClone/Scripts" || exit
#         ./restore_lnk.sh
        
        
#         exit 0
#     ;;
# esac


do_gen_completion() { #? Generate Shell Completions
    manPage=$(
cat << HEADER
# Autogenerated file 'Hyde shell_completion'
# This is a file fed to complgen to generate bash/fish/zsh completions
# Repo: https://github.com/adaszko/complgen
# Generate completion scripts: "complgen aot --bash-script Hyde.bash --fish-script Hyde.fish --zsh-script Hyde.zsh ./Hyde.usage"

Hyde <COMMANDS>
HEADER
        echo "<COMMANDS> ::="
        grep -E '^\w+ *\( *\)\s*\{ #\?' $0 | while read -r line; do
            Function=$(echo "$line" | awk 'BEGIN { FS = "[()#?]" } { print $1 }')
            desc=$(echo -ne "$line" | awk 'BEGIN { FS = "[()#?]" } { print $5 }')
            printf "%s %-50s %s" "\n\t\t| " "(${Function} <${Function^^}_OPERATIONS> ) " "\"${desc}\""
        done
        echo -e ';\n\n'
        grep -E '^\w+ *\( *\)\s*\{ #\?' $0 | while read -r line; do
            Function=$(echo "$line" | awk 'BEGIN { FS = "[()#?]" } { print $1 }')
            caps_func=$Function
    if awk "/^$Function\(\) \{/,/}/" "$0" | grep >/dev/null 'case'; then
        # man_params=$(awk "/^$Function\(\) \{/,/esac;/" "$0" | grep -E '^\s+\w+\)' | awk -v indent="\t\t\t\t\t\t" 'BEGIN { FS = "[()#?]" } { sub(/^[ \t]+/, "", $1); gsub(/\\n/, "\\n" indent, $4); printf "%s %s","(" $1 ")\t","\""$4"\"" "\n\t\t| \t" }')
man_params=$(awk "/^$Function\(\) \{/,/esac;/" "$0" | grep -E '^\s+\w+\)' | awk -v indent="\t\t\t\t\t\t" 'BEGIN { FS = "[()#?]" } { sub(/^[ \t]+/, "", $1); gsub(/\\n/, " ", $4); printf "%s %s","(" $1 ")\t","\""$4"\"" "\n\t\t| \t" }')

        echo "<${caps_func^^}_FUNCTION> ::="    
        # echo -e "${man_params}"
        echo -e "${man_params}" | awk 'NF > 1'

        echo -e ';\n\n'
    fi
        done ; 


    )
    echo -e "${manPage}" |
        sed -e "s|\${CloneDir}|$CloneDir|g" \
            -e "s|\${HOME}|${HOME}|g" \
            -e "s|\${hydeConfDir}|${hydeConfDir}|g" \
            -e "s|\${ctlFile}|$ctlFile|g"


}

OPT=(
    "completion?? do_gen_completion "
    "command??  "
    "command??  "
)

printf "%s\n" "${OPT[@]}" | fzf
















exit 0